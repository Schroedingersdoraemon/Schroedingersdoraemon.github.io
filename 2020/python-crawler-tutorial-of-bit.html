<!doctype html><title>
Python Crawler Tutorial of BIT
    </title><meta charset=utf-8><meta content=width=device-width initial-scale=1 name=viewport><link href=/theme/css/main.css rel=stylesheet><body><h1>Python Crawler Tutorial of BIT</h1> 2020-03-13 22:24 <hr><h1>一、Week1:规则</h1><h2>1. Library: Requests</h2><h3>(1). requests</h3><div class=highlight><pre><span></span><code>r = requests.get(url, params=None, **kwargs)
</code></pre></div><div class=highlight><pre><span></span><code>  <span class=c1>#!/usr/bin/python</span>
  <span class=kn>import</span> <span class=nn>requests</span>
  <span class=n>r</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'http://www.baidu.com'</span><span class=p>)</span>
  <span class=nb>type</span><span class=p>(</span><span class=n>r</span><span class=p>)</span>
  <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>headers</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
      <span class=nb>print</span><span class=p>(</span><span class=s1>'Access success'</span><span class=p>)</span>
  <span class=k>else</span> <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>headers</span> <span class=o>==</span><span class=mi>404</span><span class=p>:</span>
      <span class=nb>print</span><span class=p>(</span><span class=s1>'Access denied'</span><span class=p>)</span>

  <span class=n>r</span><span class=o>.</span><span class=n>headers</span>
  <span class=n>r</span><span class=o>.</span><span class=n>text</span>
  <span class=n>r</span><span class=o>.</span><span class=n>encoding</span>            <span class=c1>#HTTP header中获取字段</span>
  <span class=n>r</span><span class=o>.</span><span class=n>apparent_encoding</span>   <span class=c1>#从内容中分析出的响应内容编码方式（备选）</span>
  <span class=n>r</span><span class=o>.</span><span class=n>content</span>
</code></pre></div><h3>(2). universal framework</h3><table><thead><tr><th style=text-align:center><th style=text-align:center><tbody><tr><td style=text-align:center>requests.ConnectionError<td style=text-align:center>网络连接错误<tr><td style=text-align:center>requests.HTTPError<td style=text-align:center>HTTP错误异常<tr><td style=text-align:center>requests.URLRuquired<td style=text-align:center>URL缺失异常<tr><td style=text-align:center>requests.TooManyRedirects<td style=text-align:center>重定向<tr><td style=text-align:center>requests.ConnectTimeout<td style=text-align:center>连接远程服务器超时异常<tr><td style=text-align:center>requests.Timeout<td style=text-align:center>请求URL超时</table><div class=highlight><pre><span></span><code><span class=ch>#!/usr/bin/python</span>
<span class=kn>import</span> <span class=nn>requests</span>

<span class=k>def</span> <span class=nf>getHTMLtext</span><span class=p>(</span><span class=n>url</span><span class=p>):</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>timeout</span> <span class=o>=</span> <span class=mi>30</span><span class=p>)</span>
        <span class=n>r</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span> <span class=c1>#如果r.status！= 200，产生异常requests.HTTPError</span>
        <span class=n>r</span><span class=o>..</span><span class=n>encoding</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>apparent_encoding</span>
        <span class=k>return</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span>
    <span class=k>except</span><span class=p>:</span>
        <span class=k>return</span> <span class=s2>"Error occurred"</span>

    <span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>'__main__'</span><span class=p>:</span>
        <span class=n>url</span> <span class=o>=</span> <span class=s1>'https://www.baidu.com'</span>
        <span class=nb>print</span><span class=p>(</span><span class=n>getHTMLtext</span><span class=p>)</span>
</code></pre></div><h3>(3). 7 major methods of Requests</h3><table><thead><tr><th style=text-align:center>METHODS<th style=text-align:center>INTRODUCTION<tbody><tr><td style=text-align:center>requests.request()<td style=text-align:center><tr><td style=text-align:center>requests.get()<td style=text-align:center>major method to get HTML webpage<tr><td style=text-align:center>requests.head()<td style=text-align:center>header information<tr><td style=text-align:center>requests.post()<td style=text-align:center>submit POST resourses<tr><td style=text-align:center>requests.put()<td style=text-align:center>submit PUT(replace)<tr><td style=text-align:center>requests.patch()<td style=text-align:center>partially modified requests<tr><td style=text-align:center>requests.delete()<td style=text-align:center>delete</table><p>HTTP, Hyper Text Transfer Protocol URL: <code>http://host[:port][path]</code><div class=highlight><pre><span></span><code><span class=ch>#!/usr/bin/python</span>
<span class=c1>#requests.post</span>

<span class=n>payload</span> <span class=o>=</span> <span class=p>{</span><span class=s1>'key1'</span><span class=p>:</span><span class=s1>'value1'</span><span class=p>,</span> <span class=s1>'key2'</span><span class=p>:</span><span class=s1>'value2'</span><span class=p>}</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>URL</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>payload</span><span class=s1>')</span>
<span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
<span class=sd>'''</span>
<span class=sd>{</span>
<span class=sd>    ...</span>
<span class=sd>    "form":{</span>
<span class=sd>        "key2":"value2",</span>
<span class=sd>        "key1":"value1"</span>
<span class=sd>    },</span>
<span class=sd>}</span>
<span class=sd>'''</span>

<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>URL</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=s1>'just a piece of text'</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
<span class=sd>'''</span>
<span class=sd>{</span>
<span class=sd>    ...</span>
<span class=sd>    "data":"just a piece of text"</span>
<span class=sd>    "form":{}</span>
<span class=sd>}</span>
<span class=sd>'''</span>
</code></pre></div><h3>(4). More about Requests</h3><p>(0). <code>requests.request(method, url, **kwargs)</code><br> method = ['GET', 'HEAD', 'POST', 'PUT', 'PATCH', 'deleta', 'OPTIONS']<br> (1). <code>params</code><div class=highlight><pre><span></span><code><span class=ch>#!/usr/bin/python</span>
<span class=n>kv</span> <span class=o>=</span> <span class=p>{</span><span class=s1>'key1'</span><span class=p>:</span><span class=s1>'value1'</span><span class=p>,</span> <span class=s1>'key2'</span><span class=p>:</span><span class=s1>'value2'</span><span class=p>}</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=s1>'GET'</span><span class=p>,</span> <span class=n>URL</span><span class=p>,</span> <span class=n>patams</span> <span class=o>=</span> <span class=n>kv</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>url</span><span class=p>)</span>
<span class=n>URL</span><span class=err>?</span><span class=n>key1</span><span class=o>=</span><span class=n>value1</span><span class=o>&</span><span class=n>key2</span><span class=o>=</span><span class=n>value2</span>
</code></pre></div><p>(2). <code>data</code><div class=highlight><pre><span></span><code><span class=ch>#!/usr/bin/python</span>
<span class=n>kv</span> <span class=o>=</span> <span class=p>{</span><span class=s1>'key1'</span><span class=p>:</span><span class=s1>'value1'</span><span class=p>,</span> <span class=s1>'key2'</span><span class=p>:</span><span class=s1>'value2'</span><span class=p>}</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=s1>'POST'</span><span class=p>,</span> <span class=n>URL</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>kv</span><span class=p>)</span>
<span class=n>body</span> <span class=o>=</span> <span class=s1>'textbody'</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=s1>'POST'</span><span class=p>,</span> <span class=n>URL</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>body</span><span class=p>)</span>
</code></pre></div><p>(3). <code>json</code><div class=highlight><pre><span></span><code><span class=n>kv</span> <span class=o>=</span> <span class=p>{</span><span class=s1>'key1'</span><span class=p>:</span><span class=s1>'value1'</span><span class=p>,</span> <span class=s1>'key2'</span><span class=p>:</span><span class=s1>'value2'</span><span class=p>}</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=s1>'POST'</span><span class=p>,</span> <span class=n>URL</span><span class=p>,</span> <span class=n>json</span> <span class=o>=</span> <span class=n>kv</span><span class=p>)</span>
</code></pre></div><p>(4). <code>headers</code><div class=highlight><pre><span></span><code><span class=n>hd</span> <span class=o>=</span> <span class=p>{</span><span class=s1>'user-agent'</span><span class=p>:</span><span class=s1>'Chrome/10'</span><span class=p>}</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=s1>'POST'</span><span class=p>,</span> <span class=n>URL</span><span class=p>,</span> <span class=n>headers</span> <span class=o>=</span> <span class=n>hd</span><span class=p>)</span>
</code></pre></div><p>(5). <code>cookie</code><br> advanced<p>(6). <code>auth</code><br> advanced<p>(7). <code>files</code><div class=highlight><pre><span></span><code><span class=n>fs</span> <span class=o>=</span> <span class=p>{</span><span class=s1>'file'</span><span class=p>:</span><span class=nb>open</span><span class=p>(</span><span class=s1>'data.csv'</span><span class=p>,</span> <span class=s1>'rb'</span><span class=p>)}</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=s1>'POST'</span><span class=p>,</span> <span class=n>URL</span><span class=p>,</span> <span class=n>files</span> <span class=o>=</span> <span class=n>fs</span><span class=p>)</span>
</code></pre></div><p>(8). <code>timeout</code><p>(9). <code>proxies</code><div class=highlight><pre><span></span><code><span class=n>pxs</span> <span class=o>=</span> <span class=p>{</span><span class=s1>'http'</span><span class=p>:</span><span class=s1>'http://user:pass@10.10.10.1:1234'</span>
       <span class=s1>'https'</span><span class=p>:</span><span class=s1>'https://10.10.10.1:4321'</span> <span class=p>}</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=s1>'GET'</span><span class=p>,</span><span class=n>URL</span><span class=p>,</span> <span class=n>proxies</span> <span class=o>=</span> <span class=n>pxs</span><span class=p>)</span>
</code></pre></div><table><thead><tr><th style=text-align:center><th style=text-align:center>**args<th style=text-align:center><tbody><tr><td style=text-align:center>1<td style=text-align:center>params<td style=text-align:center>dictionary or text sequences<tr><td style=text-align:center>2<td style=text-align:center>data<td style=text-align:center>dictionary, text sequences or file object<tr><td style=text-align:center>3<td style=text-align:center>json<td style=text-align:center>ad titled<tr><td style=text-align:center>4<td style=text-align:center>headers<td style=text-align:center>HTTP headers<tr><td style=text-align:center>5<td style=text-align:center>cookies<td style=text-align:center>dict or CookieJar<tr><td style=text-align:center>6<td style=text-align:center>auth<td style=text-align:center>tuple<tr><td style=text-align:center>7<td style=text-align:center>files<td style=text-align:center>dict, file transfer<tr><td style=text-align:center>8<td style=text-align:center>timeout<td style=text-align:center>seconds<tr><td style=text-align:center>9<td style=text-align:center>proxies<td style=text-align:center>dict<tr><td style=text-align:center>10<td style=text-align:center>allow_redirects<td style=text-align:center>default: True<tr><td style=text-align:center>11<td style=text-align:center>stream<td style=text-align:center>fetch contents, download instantly(default: True)<tr><td style=text-align:center>12<td style=text-align:center>verify<td style=text-align:center>verify SSL certificate(default True)<tr><td style=text-align:center>13<td style=text-align:center>cer<td style=text-align:center>local SSL certificate path</table><h2>2. 爬虫的‘盗亦有道’</h2><h3>(1). 爬虫引发的问题</h3><blockquote><p>Requests: 小规模，数据量小，速度不敏感 Scrapy: 中规模，数据规模较大，速度敏感 Google, Bing: 大规模，搜索引擎，速度关键</blockquote><ul><li>Sources check：判断HTTP headers的User-Agent域<li>Annountment: Robots</ul><h3>(2). Robots protocol</h3><p>Robots Exclusion Standard<br> location: <code>host/robots.txt</code><p>Grammar<blockquote><p>User-agent: * Disallow: /</blockquote><p>i.e. <em>https://www.jd.com/robots.txt</em><blockquote><p>User-agent: * <br> Disallow: /?<em> <br> Disallow: /pop/</em>.html <br> Disallow: /pinpai/<em>.html?</em> <br> User-agent: EtaoSpider <br> Disallow: /<br> User-agent: HuihuiSpider <br> Disallow: / <br> User-agent: GwdangSpider <br> Disallow: / <br> User-agent: WochachaSpider <br> Disallow: /</blockquote><h3>(3). Robots protocol</h3><p>dylan 说：别吃牢饭就好～<h3>(4). Practice</h3><h4>1. jd.com</h4><p>京东上默认第一 Lolita 裙的信息（逃）<div class=highlight><pre><span></span><code><span class=ch>#!/usr/bin/python</span>
<span class=kn>import</span> <span class=nn>requests</span>
<span class=n>url</span> <span class=o>=</span> <span class=s1>'https://item.jd.com/55949296412.html'</span>
<span class=k>try</span><span class=p>:</span>
    <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
    <span class=n>r</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
    <span class=n>r</span><span class=o>.</span><span class=n>encoding</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>apparent_encoding</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>[:</span><span class=mi>1000</span><span class=p>])</span>
<span class=k>except</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=s1>'Error occured'</span><span class=p>)</span>
</code></pre></div><h4>2. Amazon</h4><p>Amazon上面的 Lolita 裙<div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>requests</span>
<span class=n>url</span> <span class=o>=</span> <span class=s1>'https://www.amazon.cn/dp/B07MQSJQC4/ref=sr_1_12?__mk_zh_CN=</span><span class=si>%E</span><span class=s1>4%BA%9A</span><span class=si>%E</span><span class=s1>9%A9%AC</span><span class=si>%E</span><span class=s1>9</span><span class=si>%80%</span><span class=s1>8A</span><span class=si>%E</span><span class=s1>7%BD</span><span class=si>%91%</span><span class=s1>E7%AB%99&dchild=1&keywords=lolita&qid=1586515136&sr=8-12'</span>

<span class=k>try</span><span class=p>:</span>
    <span class=n>kv</span> <span class=o>=</span> <span class=p>{</span><span class=s1>'User-Agent'</span><span class=p>:</span><span class=s1>'Mozilla/5.0'</span><span class=p>}</span>
    <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=s1>'GET'</span><span class=p>,</span><span class=n>url</span><span class=p>,</span><span class=n>headers</span> <span class=o>=</span> <span class=n>kv</span><span class=p>)</span>
    <span class=n>r</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
    <span class=n>r</span><span class=o>.</span><span class=n>encoding</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>apparent_coding</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>[</span><span class=mi>1000</span><span class=p>:</span><span class=mi>2000</span><span class=p>])</span>
<span class=k>except</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=s1>'Error occurred'</span><span class=p>)</span>
</code></pre></div><h4>3. baidu关键词提交</h4><p><code>baidu api:</code> <code>https://www.baidu.com/s?wd=</code>+ keywords<div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>requests</span>

<span class=kn>import</span> 
<span class=nn>kw</span> <span class=o>=</span> <span class=p>{</span><span class=s1>'wd'</span><span class=p>:</span><span class=s1>'Lolita裙'</span><span class=p>}</span>
<span class=n>kv</span> <span class=o>=</span> <span class=p>{</span><span class=s1>'User-Agent'</span><span class=p>:</span><span class=s1>'Mozilla/5.0'</span><span class=p>}</span>
<span class=n>url</span> <span class=o>=</span> <span class=s1>'https://www.baidu.com/s'</span>
<span class=k>try</span><span class=p>:</span>
    <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>params</span> <span class=o>=</span> <span class=n>kw</span><span class=p>,</span> <span class=n>headers</span> <span class=o>=</span> <span class=n>kv</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=p>)</span>
    <span class=n>r</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
    <span class=nb>print</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>))</span>
<span class=k>except</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=s1>'Error occurred'</span><span class=p>)</span>
</code></pre></div><h4>4. Pictures / Videos</h4><p>用途：老婆们的图 / 视频<div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>requests</span>
<span class=kn>import</span> <span class=nn>os</span>

<span class=n>url</span> <span class=o>=</span> <span class=s1>'https://tva2.sinaimg.cn/large/87c01ec7gy1fsnqqz23i'</span>
<span class=n>root</span> <span class=o>=</span> <span class=s1>'./'</span>
<span class=n>path</span> <span class=o>=</span> <span class=n>root</span> <span class=o>+</span> <span class=n>url</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>'/'</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>

<span class=k>try</span><span class=p>:</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=s1>'GET'</span><span class=p>,</span><span class=n>url</span><span class=p>)</span>
        <span class=n>r</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span><span class=s1>'wb'</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
            <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>content</span><span class=p>)</span>
            <span class=n>f</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
            <span class=nb>print</span><span class=p>(</span><span class=s1>'Successfully saved!'</span><span class=p>)</span>
<span class=k>except</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=s1>'Failed'</span><span class=p>)</span>
</code></pre></div><h4>5. IP address</h4><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>requests</span>
<span class=n>url</span> <span class=o>=</span> <span class=s1>'http://m.ip138.com/ip.asp?ip='</span>
<span class=n>ip</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s1>'Enter ur ip address:'</span><span class=p>)</span>
<span class=n>kv</span> <span class=o>=</span> <span class=p>{</span><span class=s1>'User-Agent'</span><span class=p>:</span><span class=s1>'Mozilla/5.0'</span><span class=p>}</span>
<span class=k>try</span><span class=p>:</span>
    <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span> <span class=o>+</span> <span class=n>ip</span><span class=p>,</span> <span class=n>timeout</span> <span class=o>=</span> <span class=mi>10</span><span class=p>)</span>
    <span class=n>r</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
    <span class=n>r</span><span class=o>.</span><span class=n>encoding</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>apparent_encoding</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>[</span><span class=o>-</span><span class=mi>500</span><span class=p>:])</span>
<span class=k>except</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=s1>'Error occurred'</span><span class=p>)</span>
</code></pre></div><h1>二、Week2: 语音系列</h1><h2>1. 靓汤 Beautiful Soup</h2><h3>(1). 靓汤安装</h3><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>requests</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'http://python123.io/ws/demo.html'</span><span class=p>)</span>
<span class=n>demo</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span>

<span class=kn>from</span> <span class=nn>bs4</span> <span class=kn>import</span> <span class=n>BeautifulSoup</span>
<span class=n>soup</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>demo</span><span class=p>,</span> <span class=s1>'html.parser'</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>soup</span><span class=o>.</span><span class=n>prettify</span><span class=p>())</span>
</code></pre></div><h3>(2). 靓汤基本元素</h3><div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>bs4</span> <span class=kn>import</span> <span class=n>BeautifulSoup</span>
<span class=n>soup</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=s1>'&LThtml>data&LT/html>'</span><span class=p>,</span> <span class=s1>'html.parser'</span><span class=p>)</span>
<span class=n>soup2</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=s1>'./demo.html'</span><span class=p>),</span> <span class=s1>'html.parser'</span><span class=p>)</span>
</code></pre></div><table><thead><tr><th style=text-align:center>parser<th style=text-align:center>use<tbody><tr><td style=text-align:center>bs4 HTML<td style=text-align:center>BeautifulSoup(mk, 'html.parser')<tr><td style=text-align:center>lxml HTML<td style=text-align:center>BeautifulSoup(mk, '<code>lxml</code>')<tr><td style=text-align:center>lxml XML<td style=text-align:center>BeautifulSoup(mk, '<code>xml</code>')<tr><td style=text-align:center>html5lib<td style=text-align:center>BeautifulSoup(mk, '<code>html5lib</code>')</table><table><thead><tr><th style=text-align:center>Element<th style=text-align:center>About<tbody><tr><td style=text-align:center>Tag<td style=text-align:center><>和标明开头结尾<tr><td style=text-align:center>Name<td style=text-align:center>标签名字, <code>&LTp</code>>...<code>&LT/p</code>>的名字是 p , 格式：<code>&LTtag></code>.name<tr><td style=text-align:center>Attributes<td style=text-align:center>字典形式， <code>&LTtag></code>.attrs<tr><td style=text-align:center>NavigableString<td style=text-align:center>非属性字符串,<>...中字符串， 格式：<code>&LTtag></code>.string<tr><td style=text-align:center>Comment<td style=text-align:center>注释</table><div class=highlight><pre><span></span><code> <span class=p><</span><span class=nt>html</span><span class=p>></span>  
   <span class=p><</span><span class=nt>body</span><span class=p>></span>  
       <span class=p><</span><span class=nt>p</span> <span class=na>class </span><span class=o>=</span> <span class=s>'title'</span><span class=p>></span>...<span class=p>&LT/</span><span class=nt>p</span><span class=p>></span>  
   <span class=p>&LT/</span><span class=nt>body</span><span class=p>></span>  
 <span class=p>&LT/</span><span class=nt>html</span><span class=p>></span>
</code></pre></div><h3>(3). HTML内容遍历方法based on bs4</h3><table><thead><tr><th style=text-align:center>attrs<th style=text-align:center>about<tbody><tr><td style=text-align:center>.contents<td style=text-align:center><code>&LTtag></code>子节点存入列表<tr><td style=text-align:center>.children<td style=text-align:center>children<tr><td style=text-align:center>.descentants<td style=text-align:center>recursive children</table><table><thead><tr><th style=text-align:center>attrs<th style=text-align:center>about<tbody><tr><td style=text-align:center>parent<td style=text-align:center>father<tr><td style=text-align:center>parents<td style=text-align:center>recursive father</table><table><thead><tr><th style=text-align:center>attrs<th style=text-align:center>about<tbody><tr><td style=text-align:center>.next_sibling<td style=text-align:center>as named<tr><td style=text-align:center>.previous_sibling<td style=text-align:center>as named<tr><td style=text-align:center>.next_siblings<td style=text-align:center>recursively<tr><td style=text-align:center>.previous_siblings<td style=text-align:center>recursively</table><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>requests</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'http://python123.io/ws/demo.html'</span><span class=p>)</span>
<span class=n>demo</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span>
<span class=n>demo</span>
</code></pre></div><div class=highlight><pre><span></span><code><span class=p><</span><span class=nt>html</span><span class=p>></span>
    <span class=p><</span><span class=nt>head</span><span class=p>></span>
        <span class=p><</span><span class=nt>title</span><span class=p>></span>This is a python demo page<span class=p>&LT/</span><span class=nt>title</span><span class=p>></span>
    <span class=p>&LT/</span><span class=nt>head</span><span class=p>></span>
    <span class=p><</span><span class=nt>body</span><span class=p>></span>
        <span class=p><</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>"title"</span><span class=p>></span>
            <span class=p><</span><span class=nt>b</span><span class=p>></span>The demo python introduces several python courses.<span class=p>&LT/</span><span class=nt>b</span><span class=p>></span>
        <span class=p>&LT/</span><span class=nt>p</span><span class=p>></span>
        <span class=p><</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>"course"</span><span class=p>></span>Python is a wonderful general-purpose programming language. You can learn Python from novice to professional by tracking the following courses:
            <span class=p><</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>"http://www.icourse163.org/course/BIT-268001"</span> <span class=na>class</span><span class=o>=</span><span class=s>"py1"</span> <span class=na>id</span><span class=o>=</span><span class=s>"link1"</span><span class=p>></span>Basic Python<span class=p>&LT/</span><span class=nt>a</span><span class=p>></span> 
            and<span class=p><</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>"http://www.icourse163.org/course/BIT-1001870001"</span> <span class=na>class</span><span class=o>=</span><span class=s>"py2"</span> <span class=na>id</span><span class=o>=</span><span class=s>"link2"</span><span class=p>></span>Advanced Python<span class=p>&LT/</span><span class=nt>a</span><span class=p>></span>.
        <span class=p>&LT/</span><span class=nt>p</span><span class=p>></span>
    <span class=p>&LT/</span><span class=nt>body</span><span class=p>></span>
<span class=p>&LT/</span><span class=nt>html</span><span class=p>></span>
</code></pre></div><div class=highlight><pre><span></span><code><span class=c1>#下行遍历</span>
<span class=k>for</span> <span class=n>child</span> <span class=ow>in</span> <span class=n>soup</span><span class=o>.</span><span class=n>body</span><span class=o>.</span><span class=n>children</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>child</span><span class=p>)</span>
</code></pre></div><div class=highlight><pre><span></span><code><span class=c1>#上行遍历</span>
<span class=k>for</span> <span class=n>parent</span> <span class=ow>in</span> <span class=n>soup</span><span class=o>.</span><span class=n>a</span><span class=o>.</span><span class=n>parents</span><span class=p>:</span>
    <span class=k>if</span> <span class=n>parent</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=nb>print</span><span class=p>(</span><span class=n>parent</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=nb>print</span><span class=p>(</span><span class=n>parent</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</code></pre></div><div class=highlight><pre><span></span><code><span class=c1>#平行遍历</span>
<span class=k>for</span> <span class=n>sibling</span> <span class=ow>in</span> <span class=n>soup</span><span class=o>.</span><span class=n>a</span><span class=o>.</span><span class=n>next_siblings</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>sibling</span><span class=p>)</span>
</code></pre></div><h3>(4). HTML_encoding based on bs4</h3><div class=highlight><pre><span></span><code><span class=nb>print</span><span class=p>(</span><span class=n>soup</span><span class=o>.</span><span class=n>a</span><span class=o>.</span><span class=n>prettify</span><span class=p>())</span>
</code></pre></div><h2>2. 信息提取与标记</h2><p>XML e<strong>X</strong>tensible <strong>M</strong>arkup <strong>L</strong>anguage<br> JSON <strong>J</strong>ava<strong>S</strong>cript <strong>O</strong>bjrct <strong>N</strong>otation<br> YAML <strong>Y</strong>AML <strong>A</strong>in't <strong>M</strong>arkup <strong>L</strong>anguage<div class=highlight><pre><span></span><code>&LTtag>(..) = &LTtag>.find_all(..)
i.e.
    soup(..) = soup.find_all(..)
</code></pre></div><h3>(1). XML, JSON, YAML</h3><div class=highlight><pre><span></span><code>XML
<span class=nt>&LTname></span>...<span class=nt>&LT/name></span>
<span class=nt>&LTname</span><span class=w> </span><span class=nt>/></span>
<span class=cm>&LT!--more--></span>
</code></pre></div><div class=highlight><pre><span></span><code><span class=nt>&LTperson></span>
<span class=w>    </span><span class=nt>&LTfirstName></span>forename<span class=nt>&LT/firstName></span>
<span class=w>    </span><span class=nt>&LTlastName></span>surname<span class=nt>&LT/lastName></span>
<span class=w>    </span><span class=nt>&LTaddress></span>
<span class=w>        </span><span class=nt>&LTstreetAddr></span>Happy<span class=w> </span>Road<span class=w> </span>No.2<span class=nt>&LT/streetAddr></span>
<span class=w>        </span><span class=nt>&LTcity></span>Joyful<span class=w> </span>City<span class=nt>&LT/city></span>
<span class=w>    </span><span class=nt>&LT/address></span>
<span class=w>    </span><span class=nt>&LTschool></span>College<span class=nt>&LT/school>&LTschool></span>CS<span class=nt>&LT/school></span>
<span class=nt>&LT/person></span>
</code></pre></div><hr><div class=highlight><pre><span></span><code><span class=err>JSON</span>
<span class=nt>"key"</span><span class=p>:</span><span class=nt>"value"</span>
<span class=nt>"key"</span><span class=p>:[</span><span class=s2>"value1"</span><span class=p>,</span><span class=s2>"value2"</span><span class=p>]</span>
<span class=nt>"key"</span><span class=p>:{</span>
<span class=w>        </span><span class=nt>"subkey"</span><span class=p>:</span><span class=s2>"subvalue"</span><span class=w> </span><span class=p>}</span>
</code></pre></div><div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=nt>"firstName"</span><span class=p>:</span><span class=s2>"forename"</span><span class=p>,</span>
<span class=w>    </span><span class=nt>"lastName"</span><span class=p>:</span><span class=s2>"surname"</span><span class=p>,</span>
<span class=w>    </span><span class=nt>"address"</span><span class=p>:{</span>
<span class=w>                </span><span class=nt>"streetAddr"</span><span class=p>:</span><span class=s2>"Happy Road No.2"</span><span class=p>,</span>
<span class=w>                </span><span class=nt>"city"</span><span class=p>:</span><span class=s2>"Joyful City"</span>
<span class=w>                </span><span class=p>}</span>
<span class=w>    </span><span class=nt>"school"</span><span class=p>:[</span><span class=s2>"college"</span><span class=p>,</span><span class=s2>"CS"</span><span class=p>]</span>

<span class=p>}</span>
</code></pre></div><hr><div class=highlight><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">YAML</span>
<span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">value</span>
<span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=c1>#Comment</span>
<span class="l l-Scalar l-Scalar-Plain">-value1</span>
<span class="l l-Scalar l-Scalar-Plain">-value2</span>
<span class=nt>key </span><span class=p>:</span>
<span class=w>    </span><span class=nt>subkey </span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">subvalue</span>
</code></pre></div><div class=highlight><pre><span></span><code><span class=nt>firstName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">forename</span>
<span class=nt>lastName </span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">surname</span>
<span class=nt>address</span><span class=p>:</span>
<span class=w>    </span><span class=nt>streetAddr </span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Happy Road No.2</span>
<span class=w>    </span><span class=nt>city </span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Joyful City</span>
<span class=nt>school</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">college</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CS</span>
</code></pre></div><h3>(2). Common way to extract information</h3><div class=highlight><pre><span></span><code><span class=k>for</span> <span class=n>link</span> <span class=ow>in</span> <span class=n>soup</span><span class=o>.</span><span class=n>find_all</span><span class=p>(</span><span class=s1>'a'</span><span class=p>):</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'href'</span><span class=p>))</span>
</code></pre></div><h3>(3). HTML content search based on bs4</h3><p>soup.find_all(param)<table><thead><tr><th style=text-align:center>param<th style=text-align:center>about<tbody><tr><td style=text-align:center>name<td style=text-align:center><tr><td style=text-align:center>attrs<td style=text-align:center><tr><td style=text-align:center>recursive<td style=text-align:center>default = True<tr><td style=text-align:center>string<td style=text-align:center></table><table><thead><tr><th style=text-align:center>method<th style=text-align:center>about<tbody><tr><td style=text-align:center><>.find<td style=text-align:center><tr><td style=text-align:center><>.find_parent()<td style=text-align:center><tr><td style=text-align:center><>.find_parents()<td style=text-align:center><tr><td style=text-align:center><>.find_next_sibling()<td style=text-align:center><tr><td style=text-align:center><>.find_next_siblings()<td style=text-align:center><tr><td style=text-align:center><>.find_previous_sibling()<td style=text-align:center><tr><td style=text-align:center><>.find_previous_siblings()<td style=text-align:center><tr><td style=text-align:center><><td style=text-align:center></table><h4>(4). Practice</h4><h5>1. University Ranking</h5><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>requests</span>
<span class=kn>from</span> <span class=nn>bs4</span> <span class=kn>import</span> <span class=n>BeautifulSoup</span>
<span class=kn>import</span> <span class=nn>bs4</span>

<span class=k>def</span> <span class=nf>getHTMLText</span><span class=p>(</span><span class=n>url</span><span class=p>):</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=s1>'GET'</span><span class=p>,</span><span class=n>url</span><span class=p>)</span>
        <span class=n>r</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
        <span class=n>r</span><span class=o>.</span><span class=n>encoding</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>apparent_encoding</span>
        <span class=k>return</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span>
    <span class=k>except</span><span class=p>:</span>
        <span class=k>return</span> <span class=s1>''</span>

<span class=k>def</span> <span class=nf>Univ2List</span><span class=p>(</span><span class=n>ulist</span><span class=p>,</span> <span class=n>html</span><span class=p>):</span>
    <span class=n>soup</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>html</span><span class=p>,</span> <span class=s1>'html.parser'</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>tr</span> <span class=ow>in</span> <span class=n>soup</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s1>'tbody'</span><span class=p>)</span><span class=o>.</span><span class=n>children</span><span class=p>:</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>tr</span><span class=p>,</span> <span class=n>bs4</span><span class=o>.</span><span class=n>element</span><span class=o>.</span><span class=n>Tag</span><span class=p>):</span>
            <span class=n>tds</span> <span class=o>=</span> <span class=n>tr</span><span class=p>(</span><span class=s1>'td'</span><span class=p>)</span>
            <span class=n>ulist</span><span class=o>.</span><span class=n>append</span><span class=p>([</span><span class=n>tds</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>string</span><span class=p>,</span> <span class=n>tds</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>string</span><span class=p>,</span> <span class=n>tds</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>string</span><span class=p>])</span>

<span class=k>def</span> <span class=nf>PrintUnivList</span><span class=p>(</span><span class=n>ulist</span><span class=p>,</span> <span class=n>num</span><span class=p>):</span>
    <span class=nb>print</span><span class=p>(</span><span class=s1>'</span><span class=si>{:^10}</span><span class=se>\t</span><span class=si>{:^10}</span><span class=se>\t</span><span class=si>{:^10}</span><span class=s1>'</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s1>'排名'</span><span class=p>,</span><span class=s1>'学校'</span><span class=p>,</span><span class=s1>'分数'</span><span class=p>))</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num</span><span class=p>):</span>
        <span class=n>u</span> <span class=o>=</span> <span class=n>ulist</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
        <span class=nb>print</span><span class=p>(</span><span class=s1>'</span><span class=si>{:^10}</span><span class=se>\t</span><span class=si>{:^6}</span><span class=se>\t</span><span class=si>{:^10}</span><span class=s1>'</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>u</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>u</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>u</span><span class=p>[</span><span class=mi>2</span><span class=p>]))</span>

<span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
    <span class=n>ulist</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>url</span> <span class=o>=</span> <span class=s1>'http://www.zuihaodaxue.com/zuihaodaxuepaiming2019.html'</span>
    <span class=n>html</span> <span class=o>=</span> <span class=n>getHTMLText</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
    <span class=n>Univ2List</span><span class=p>(</span><span class=n>ulist</span><span class=p>,</span><span class=n>html</span><span class=p>)</span>
    <span class=n>PrintUnivList</span><span class=p>(</span><span class=n>ulist</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>

<span class=n>main</span><span class=p>()</span>
</code></pre></div><p>Modify the print list.<div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>PrintUnivList</span><span class=p>(</span><span class=n>ulist</span><span class=p>,</span> <span class=n>num</span><span class=p>):</span>
    <span class=n>tplt</span> <span class=o>=</span> <span class=s1>'</span><span class=si>{0:^10}</span><span class=se>\t</span><span class=s1>{1:</span><span class=si>{3}</span><span class=s1>^10}</span><span class=se>\t</span><span class=si>{2:^10}</span><span class=s1>'</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>tplt</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s1>'排名'</span><span class=p>,</span><span class=s1>'学校'</span><span class=p>,</span><span class=s1>'分数'</span><span class=p>,</span> <span class=nb>chr</span><span class=p>(</span><span class=mi>12288</span><span class=p>)))</span>
        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num</span><span class=p>):</span>
            <span class=n>u</span> <span class=o>=</span> <span class=n>ulist</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
            <span class=nb>print</span><span class=p>(</span><span class=n>tplt</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>u</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>u</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>u</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span><span class=nb>chr</span><span class=p>(</span><span class=mi>12288</span><span class=p>)))</span>
</code></pre></div><h1>三、Week3: MORE</h1><h2>1. Regular Expression</h2><h3>(1). concept</h3><div class=highlight><pre><span></span><code>i.e.
'PN'
'PYN'
'PYTN'
'PYTHN'
'PYTHON'
=
P(Y|YT|YTH|YTHO)?N
</code></pre></div><div class=highlight><pre><span></span><code>#i.e. 
'PY'开头
后续存在不多于10个字符
后续字符不能是'P'或'Y'

re: PY[^PY][0:10]
</code></pre></div><h3>(2). grammar</h3><table><thead><tr><th style=text-align:center>操作符<th style=text-align:center>说明<th style=text-align:center>i.e.<tbody><tr><td style=text-align:center>.<td style=text-align:center>any single character<td style=text-align:center><tr><td style=text-align:center>[ ]<td style=text-align:center>characters range<td style=text-align:center>[abc]表示a,b,c [a-z]:a,b...z<tr><td style=text-align:center>[^ ]<td style=text-align:center>non-characters<td style=text-align:center>[^abc]表示not a , b or c<tr><td style=text-align:center>*<td style=text-align:center>前字符0或无穷扩展<td style=text-align:center>abc*表示ab, abc, abcc etc<tr><td style=text-align:center>+<td style=text-align:center>前字符1或无穷扩展<td style=text-align:center>abc+表示abc, abcc etc<tr><td style=text-align:center>?<td style=text-align:center>前字符0或1扩展<td style=text-align:center>abc?表示ab, abc<tr><td style=text-align:center>1<td style=text-align:center>左右任意<td style=text-align:center>abc1def表示abc, def<tr><td style=text-align:center>{m}<td style=text-align:center>扩展前字符m次<td style=text-align:center>ab{2}c表示abbc<tr><td style=text-align:center>{m, n}<td style=text-align:center>扩展前字符m-n次<td style=text-align:center>ab{1, 2}c表示abc, abbc<tr><td style=text-align:center>^<td style=text-align:center>开头<td style=text-align:center>^abc表示abc且在开头<tr><td style=text-align:center>$<td style=text-align:center>结尾<td style=text-align:center>abc$表示abc且在结尾<tr><td style=text-align:center>()<td style=text-align:center>分组标记，内部使用1<td style=text-align:center>(abc)表示abc, (abc1def)表示abc, def<tr><td style=text-align:center>\d<td style=text-align:center>=[0-9]<td style=text-align:center><tr><td style=text-align:center>\w<td style=text-align:center>=[A-Za-z0-9_]<td style=text-align:center></table><div class=highlight><pre><span></span><code>examples

PY[^TH]?ON                  -       PYON, PYaON, PYbON, PYcON
PY{:#}N                     -       PN, PYN, PYYN, PYYN 
</code></pre></div><h4>classic examples</h4><table><thead><tr><th style=text-align:center>re<th style=text-align:center><tbody><tr><td style=text-align:center>^[A-Za-z]+$<td style=text-align:center>字母构成<tr><td style=text-align:center>^[A-Za-z0-9]+$<td style=text-align:center>字母和数字<tr><td style=text-align:center>^-?\d+$<td style=text-align:center>整数<tr><td style=text-align:center>^[0-9]<em>[1-9][0-9]</em>$<td style=text-align:center>正整数<tr><td style=text-align:center>[1-9]\d{5}<td style=text-align:center>邮政编码<tr><td style=text-align:center>[\u4e00-\u9fa5]<td style=text-align:center>中文字符<tr><td style=text-align:center>\d{3}-\d{8}1d{4}-\d{7}<td style=text-align:center>国内电话号码</table><h4>匹配IP地址的正则表达式</h4><div class=highlight><pre><span></span><code><span class=mf>0</span><span class=o>-</span><span class=mf>99</span><span class=w>     </span><span class=p>:</span><span class=w>   </span><span class=err>[</span><span class=mf>1</span><span class=o>-</span><span class=mf>9</span><span class=err>]?\</span><span class=n>d</span>
<span class=mf>100</span><span class=o>-</span><span class=mf>199</span><span class=w>  </span><span class=p>:</span><span class=w>    </span><span class=mf>1</span><span class=err>\</span><span class=n>d</span><span class=err>{</span><span class=mf>2</span><span class=err>}</span>
<span class=mf>200</span><span class=o>-</span><span class=mf>249</span><span class=w>  </span><span class=p>:</span><span class=w>    </span><span class=n>d</span><span class=err>[</span><span class=mf>0</span><span class=o>-</span><span class=mf>4</span><span class=err>]\</span><span class=n>d</span>
<span class=mf>250</span><span class=o>-</span><span class=mf>255</span><span class=w>  </span><span class=p>:</span><span class=w>    </span><span class=mf>25</span><span class=err>[</span><span class=mf>0</span><span class=o>-</span><span class=mf>5</span><span class=err>]</span>

<span class=p>((</span><span class=w> </span><span class=err>[</span><span class=mf>1</span><span class=o>-</span><span class=mf>9</span><span class=err>]?\</span><span class=n>d</span><span class=w> </span><span class=err>|</span><span class=w> </span><span class=mf>1</span><span class=err>\</span><span class=n>d</span><span class=err>{</span><span class=mf>2</span><span class=err>}</span><span class=w> </span><span class=err>|</span><span class=w> </span><span class=mf>2</span><span class=err>[</span><span class=mf>0</span><span class=o>-</span><span class=mf>4</span><span class=err>]\</span><span class=n>d</span><span class=w> </span><span class=err>|</span><span class=w> </span><span class=mf>25</span><span class=err>[</span><span class=mf>0</span><span class=o>-</span><span class=mf>5</span><span class=err>]</span><span class=w> </span><span class=p>)</span><span class=mf>.</span><span class=p>)</span><span class=err>{</span><span class=mf>3</span><span class=err>}</span><span class=p>(</span><span class=err>[</span><span class=mf>1</span><span class=o>-</span><span class=mf>9</span><span class=err>]?\</span><span class=n>d</span><span class=w> </span><span class=err>|</span><span class=w> </span><span class=mf>1</span><span class=err>\</span><span class=n>d</span><span class=err>{</span><span class=mf>2</span><span class=err>}</span><span class=w> </span><span class=err>|</span><span class=w> </span><span class=mf>2</span><span class=err>[</span><span class=mf>0</span><span class=o>-</span><span class=mf>4</span><span class=err>]\</span><span class=n>d</span><span class=w> </span><span class=err>|</span><span class=w> </span><span class=mf>25</span><span class=err>[</span><span class=mf>0</span><span class=o>-</span><span class=mf>5</span><span class=err>]</span><span class=w> </span><span class=p>)</span>
</code></pre></div><h3>(3). Re</h3><p>re库采用<code>raw string</code>类型表达正则表达式, 表示为<code>r'text'</code> <code>raw string</code>不包含转义符的字符串<table><thead><tr><th style=text-align:center>function()<th style=text-align:center>about<tbody><tr><td style=text-align:center>re.search()<td style=text-align:center>返回match对象<tr><td style=text-align:center>re.match()<td style=text-align:center>从string开始位置匹配, 返回match对象<tr><td style=text-align:center>re.findall()<td style=text-align:center>搜索字符串，返回列表<tr><td style=text-align:center>re.split()<td style=text-align:center>分割字符串,返回列表<tr><td style=text-align:center>re.finditer()<td style=text-align:center>返回match对象的迭代元素<tr><td style=text-align:center>re.sub()<td style=text-align:center>返回替代后字符串</table><h4>1) re.search(pattern, string, flags = 0)</h4><table><thead><tr><th style=text-align:center>flags<th style=text-align:center>about<tbody><tr><td style=text-align:center>re.I re.IGNORECASE<td style=text-align:center>忽略大小写，[A-Z]可匹配小写字符<tr><td style=text-align:center>re.M re.MULTILINE<td style=text-align:center>^操作符能将给定字符串每行作为匹配开始<tr><td style=text-align:center>re.S re.DOTALL<td style=text-align:center>.匹配所有字符（默认不包括换行符）</table><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>re</span>
<span class=n>match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s1>'[1-9]\d</span><span class=si>{5}</span><span class=s1>'</span><span class=p>,</span> <span class=s1>'BIT 100081'</span><span class=p>)</span>
<span class=k>if</span> <span class=n>match</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</code></pre></div><div class=highlight><pre><span></span><code><span class=mf>10081</span>
</code></pre></div><h4>2) re.match(pattern, string, flags = 0)</h4><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>re</span>
<span class=n>match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=sa>r</span><span class=s1>'[1-9]\d</span><span class=si>{5}</span><span class=s1>'</span><span class=p>,</span> <span class=s1>'BIT 100081'</span><span class=p>)</span>
<span class=k>if</span> <span class=n>match</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</code></pre></div><div class=highlight><pre><span></span><code>None
</code></pre></div><h4>3) re.findall(pattern, string, flags = 0)</h4><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>re</span>
</code></pre></div><h4>4) re.split(patter, string, maxsplit = 0, flags = 0)</h4><p><code>maxsplit</code>最大分割数<div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>re</span>
<span class=n>re</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=sa>r</span><span class=s1>'[1-9]\d</span><span class=si>{5}</span><span class=s1>'</span><span class=p>,</span><span class=s1>'BIT 100081 TSU 100084'</span><span class=p>,</span> <span class=n>maxsplit</span> <span class=o>=</span> <span class=mi>2</span><span class=p>)</span>
</code></pre></div><p><code>['BIT', ' TSU', '']</code><h4>5) re.finditer(patter, string, flags = 0)</h4><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>re</span>
<span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>re</span><span class=o>.</span><span class=n>finditer</span><span class=p>(</span><span class=sa>r</span><span class=s1>'[1-9]\d</span><span class=si>{5}</span><span class=s1>'</span><span class=p>,</span><span class=s1>'BIT100081 THU100084'</span><span class=p>):</span>
    <span class=k>if</span> <span class=n>m</span><span class=p>:</span>
        <span class=nb>print</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</code></pre></div><div class=highlight><pre><span></span><code><span class=mf>100081</span>
<span class=mf>100084</span>
</code></pre></div><h4>6) re.sub(pattern, repl, string, count = 0, flags = 0)</h4><p><code>count</code>匹配最大次数<div class=highlight><pre><span></span><code><span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>'[1-9]\d</span><span class=si>{5}</span><span class=s1>'</span><span class=p>,</span><span class=s1>':zipcode'</span><span class=p>,</span><span class=s1>'BIT100081 THU100084'</span><span class=p>)</span>
</code></pre></div><div class=highlight><pre><span></span><code><span class=n>BIT</span><span class=o>:</span><span class=n>zipcode</span><span class=w> </span><span class=n>THU</span><span class=o>:</span><span class=n>zipcode</span>
</code></pre></div><h3>(4). Re库的match对象</h3><table><thead><tr><th style=text-align:center>attr<th style=text-align:center>about<tbody><tr><td style=text-align:center>.string<td style=text-align:center>待匹配文本<tr><td style=text-align:center>.re<td style=text-align:center>pattern对象（正则表达式）<tr><td style=text-align:center>.pos<td style=text-align:center>正则表达式搜索文本的开始位置<tr><td style=text-align:center>.endpos<td style=text-align:center>结束位置</table><table><thead><tr><th style=text-align:center>mathod<th style=text-align:center>about<tbody><tr><td style=text-align:center>.group(0)<td style=text-align:center>获得匹配后字符串<tr><td style=text-align:center>.start()<td style=text-align:center>匹配字符串在原始字符串的开始位置<tr><td style=text-align:center>.end()<td style=text-align:center>匹配字符串在原始字符串的结束位置<tr><td style=text-align:center>.span()<td style=text-align:center>返回( .start(), .end() )</table><h4>regex = re.compile(pattern, flags = 0)</h4><table><thead><tr><th style=text-align:center>function()<th style=text-align:center>about<tbody><tr><td style=text-align:center>regex.search()<td style=text-align:center>返回match对象<tr><td style=text-align:center>regex.match()<td style=text-align:center>从string开始位置匹配, 返回match对象<tr><td style=text-align:center>regex.findall()<td style=text-align:center>搜索字符串，返回列表<tr><td style=text-align:center>regex.split()<td style=text-align:center>分割字符串,返回列表<tr><td style=text-align:center>regex.finditer()<td style=text-align:center>返回match对象的迭代元素<tr><td style=text-align:center>regex.sub()<td style=text-align:center>返回替代后字符串</table><h3>(5). Re.贪婪匹配和最小匹配</h3><p>Re库默认采用<code>贪婪匹配</code>, 输出最长字符串<table><thead><tr><th style=text-align:center>op<th style=text-align:center>about<tbody><tr><td style=text-align:center>*?<td style=text-align:center>前字符扩展0～无限次，最小匹配<tr><td style=text-align:center>+?<td style=text-align:center>前字符扩展1～无限次，最小匹配<tr><td style=text-align:center>??<td style=text-align:center>前字符扩展0～1次，最小匹配<tr><td style=text-align:center>{m, n}?<td style=text-align:center>前字符扩展m～n次，最小匹配</table><h2>2. 淘宝商品价格比较</h2><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>requests</span>
<span class=kn>import</span> <span class=nn>re</span>

<span class=k>def</span> <span class=nf>get_html_text</span><span class=p>(</span><span class=n>url</span><span class=p>):</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=n>kv</span> <span class=o>=</span> <span class=p>{</span><span class=s1>'user-agent'</span><span class=p>:</span><span class=s1>'Mozilla/5.0'</span><span class=p>,</span> <span class=s1>'cookie'</span><span class=p>:</span><span class=s1>'PLEASE FILL YOUR LOCAL COOKIE'</span><span class=p>}</span>
        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=s1>'GET'</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>timeout</span> <span class=o>=</span> <span class=mi>30</span><span class=p>,</span> <span class=n>headers</span> <span class=o>=</span> <span class=n>kv</span><span class=p>)</span>
        <span class=n>r</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
        <span class=n>r</span><span class=o>.</span><span class=n>encoding</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>apparent_encoding</span>
        <span class=k>return</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span>
    <span class=k>except</span><span class=p>:</span>
        <span class=k>return</span> <span class=s1>''</span>

<span class=k>def</span> <span class=nf>parse_page</span><span class=p>(</span><span class=n>ilt</span><span class=p>,</span> <span class=n>html</span><span class=p>):</span>
    <span class=n>prices</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>items</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=n>prices</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>r</span><span class=s1>'"view_price":"[\d\.]+"'</span><span class=p>,</span> <span class=n>html</span><span class=p>)</span>
        <span class=n>items</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>r</span><span class=s1>'"raw_title":".+?"'</span><span class=p>,</span> <span class=n>html</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>prices</span><span class=p>)):</span>
            <span class=n>price</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>prices</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>':'</span><span class=p>)[</span><span class=mi>1</span><span class=p>])</span>
            <span class=n>item</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>items</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>':'</span><span class=p>)[</span><span class=mi>1</span><span class=p>])</span>
            <span class=n>ilt</span><span class=o>.</span><span class=n>append</span><span class=p>([</span><span class=n>price</span><span class=p>,</span> <span class=n>item</span><span class=p>])</span>
    <span class=k>except</span><span class=p>:</span>
        <span class=k>return</span> <span class=s1>''</span>

<span class=k>def</span> <span class=nf>print_goods_list</span><span class=p>(</span><span class=n>ilt</span><span class=p>):</span>
    <span class=n>template</span> <span class=o>=</span> <span class=s1>'</span><span class=si>{:4}</span><span class=se>\t</span><span class=si>{:8}</span><span class=se>\t</span><span class=si>{:16}</span><span class=s1>'</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>template</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s1>'num'</span><span class=p>,</span> <span class=s1>'price'</span><span class=p>,</span> <span class=s1>'item'</span><span class=p>))</span>
    <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>ilt</span><span class=p>:</span>
        <span class=n>count</span> <span class=o>+=</span><span class=mi>1</span>
        <span class=nb>print</span><span class=p>(</span><span class=n>template</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>count</span><span class=p>,</span> <span class=n>i</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>i</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span>

<span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
    <span class=n>goods</span> <span class=o>=</span> <span class=s1>'lolita裙'</span>
    <span class=n>depth</span> <span class=o>=</span> <span class=mi>2</span>
    <span class=n>start_url</span> <span class=o>=</span> <span class=s1>'https://s.taobao.com/search?q='</span> <span class=o>+</span> <span class=n>goods</span>
    <span class=n>info_list</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>depth</span><span class=p>):</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>url</span> <span class=o>=</span> <span class=n>start_url</span> <span class=o>+</span> <span class=s1>'</span><span class=si>%s</span><span class=s1>='</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=mi>44</span><span class=o>*</span><span class=n>i</span><span class=p>)</span>
            <span class=n>html</span> <span class=o>=</span> <span class=n>get_html_text</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
            <span class=n>parse_page</span><span class=p>(</span><span class=n>info_list</span><span class=p>,</span> <span class=n>html</span><span class=p>)</span>
        <span class=k>except</span><span class=p>:</span>
            <span class=k>continue</span>
    <span class=n>print_goods_list</span><span class=p>(</span><span class=n>info_list</span><span class=p>)</span>

<span class=n>main</span><span class=p>()</span>
</code></pre></div><h2>3. 股票数据</h2>